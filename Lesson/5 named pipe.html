<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>5 named pipe</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}
#wmd-preview h2  {
    color: #AAAAFF; /* 将标题改为色 */
}
#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}
#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}
#wmd-preview h3  {
    color: #0077bb; /* 将标题改为蓝色 */
}
#wmd-preview h4  {
    color: #0077bb; /* 将标题改为light blue */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="1ub2" id="5-named-pipe">5 named pipe</h1><p data-anchor-id="llb1"><code>bash</code></p><hr><p data-anchor-id="3v8m"><div class="toc">
<ul>
<li><a href="#5-named-pipe">5 named pipe</a><ul>
<li><a href="#通道pipe">通道pipe</a></li>
<li><a href="#打开一个通道">打开一个通道</a><ul>
<li><a href="#title">&gt;</a></li>
<li><a href="#title-1">&lt;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#named-pipe">named pipe</a></li>
</ul>
</div>
</p><div class="md-section-divider"></div><h2 data-anchor-id="vn1d" id="通道pipe">通道pipe</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="jos1"><ol class="linenums"><li class="L0"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">9</span><span class="pun">&gt;</span><span class="pln">aaa</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">echo hi </span><span class="pun">&gt;&amp;</span><span class="lit">9</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">cat aaa</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln"> </span><span class="kwd">exec</span><span class="pln"> </span><span class="lit">10</span><span class="pun">&lt;</span><span class="pln">aaa</span><span class="pun">.</span><span class="pln">txt </span><span class="com">#开一个信道，从aaa.txt这个地址拿东西</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln"> cat </span><span class="pun">&lt;&amp;</span><span class="lit">10</span><span class="pln"> </span><span class="com">#cat拿到文件后，信道里就没有东西了。</span></code></li><li class="L9"><code><span class="pln">hi</span></code></li></ol></pre><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="i1ri"><ol class="linenums"><li class="L0"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">1</span><span class="pun">&gt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">log</span></code></li><li class="L1"><code><span class="pln">ls</span></code></li><li class="L2"><code><span class="pln">cat b</span><span class="pun">.</span><span class="pln">log</span></code></li><li class="L3"><code><span class="pln">cat</span><span class="pun">:</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">log</span><span class="pun">:</span><span class="pln"> input file </span><span class="kwd">is</span><span class="pln"> output file </span><span class="com">#当前bash的1&gt;子进程已经在运行了，已经是一个output file</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="com">#开一个新bash执行，1&gt;还是bash的原始定义（输出到屏幕）</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln"> cat b</span><span class="pun">.</span><span class="pln">log</span></code></li></ol></pre><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="1bp7"><ol class="linenums"><li class="L0"><code><span class="pln">ps aux </span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">ps aux </span><span class="pun">|</span><span class="pln"> grep bash</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">ps </span><span class="pun">|</span><span class="pln"> grep bash</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="z7b2" id="打开一个通道">打开一个通道</h2><div class="md-section-divider"></div><h3 data-anchor-id="8hzw" id="title">&gt;</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7qdv"><ol class="linenums"><li class="L0"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">9</span><span class="pun">&gt;</span><span class="pln">aaa</span><span class="pun">.</span><span class="pln">txt </span><span class="com">#定义9&gt;为output通往aaa.txt通道</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">echo hi </span><span class="pun">&gt;&amp;</span><span class="lit">9</span><span class="pln"> </span><span class="com">#hi去了aaa.txt</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">cat aaa</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L5"><code><span class="pln">hi</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="yru3" id="title-1">&lt;</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="btv5"><ol class="linenums"><li class="L0"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">10</span><span class="pun">&lt;</span><span class="pln">aaa</span><span class="pun">.</span><span class="pln">txt </span><span class="com">#打开一个input来自aaa.txt这个文件的通道10&lt;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">cat </span><span class="pun">&lt;&amp;</span><span class="lit">10</span></code></li><li class="L3"><code><span class="pln">hi</span></code></li><li class="L4"><code><span class="com">#从这个通道取文件aaa.txt的内容，aaa.txt的内容是一个standard input可以直接被cat命令print出来</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">cat </span><span class="pun">&lt;&amp;</span><span class="lit">10</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">cat </span><span class="pun">&lt;&amp;</span><span class="lit">10</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">echo hi </span><span class="pun">&gt;&amp;</span><span class="lit">10</span></code></li><li class="L1"><code><span class="pln">bash</span><span class="pun">:</span><span class="pln"> echo</span><span class="pun">:</span><span class="pln"> write error</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Bad</span><span class="pln"> file descriptor</span></code></li><li class="L2"><code><span class="com">#pipe closed</span></code></li></ol></pre><div class="md-section-divider"></div><h1 data-anchor-id="4cqy" id="named-pipe">named pipe</h1><p data-anchor-id="uwp3">创建一个pipe</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="x7lf"><ol class="linenums"><li class="L0"><code><span class="pln">mkfifo xxx</span><span class="pun">.</span><span class="pln">pipe </span><span class="com">#fifo=first in first out</span></code></li><li class="L1"><code><span class="com">#PCM producer Consumer Mode</span></code></li><li class="L2"><code><span class="pln">ls </span><span class="pun">-</span><span class="pln">l</span></code></li><li class="L3"><code><span class="pln">echo hi </span><span class="pun">&gt;</span><span class="pln"> xxx</span><span class="pun">.</span><span class="pln">pipe</span></code></li><li class="L4"><code><span class="com">#目前pipe处于打开状态，等待信息传过去</span></code></li><li class="L5"><code><span class="com">#开一个新bash</span></code></li><li class="L6"><code><span class="pln">cat xxx</span><span class="pun">.</span><span class="pln">pipe</span></code></li></ol></pre><p data-anchor-id="33yl">打开pipe，把结果一次性传输给xxx.pipe</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="prxm"><ol class="linenums"><li class="L0"><code><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> </span><span class="str">`seq 10`</span><span class="pun">;</span><span class="kwd">do</span><span class="pln"> echo hi</span><span class="pun">;</span><span class="kwd">done</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> aaa</span><span class="pun">.</span><span class="pln">pipe</span></code></li><li class="L1"><code><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> </span><span class="str">`seq 10`</span><span class="pun">;</span><span class="kwd">do</span><span class="pln"> echo hi</span><span class="pun">;</span><span class="pln">sleep </span><span class="lit">1s</span><span class="pun">;</span><span class="kwd">done</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> aaa</span><span class="pun">.</span><span class="pln">pipe</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">#新bash</span></code></li><li class="L4"><code><span class="pln">cat xxx</span><span class="pun">.</span><span class="pln">pipe </span><span class="com">#一次性把seq 10都显示了</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="com">##但是再次测试时，发现还是一个个显示hi,这是因为你加了sleep 1s在里面。所以本质是从pipe里，把进程输出了</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="com">#再开第三个bash</span></code></li><li class="L9"><code><span class="pln">cat xxx</span><span class="pun">.</span><span class="pln">pipe</span></code></li><li class="L0"><code><span class="com">#cat: xxx.pipe: Device or resource busy</span></code></li></ol></pre><p data-anchor-id="dlov">把结果分次（one by one）放进xxx.pipe，如果output没被接收，进程不会主动关闭</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b3qu"><ol class="linenums"><li class="L0"><code><span class="kwd">while</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">;</span><span class="kwd">do</span><span class="pln"> echo $i </span><span class="pun">&gt;</span><span class="pln"> xxx</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">;</span><span class="pln">sleep </span><span class="lit">2s</span><span class="pun">;</span><span class="kwd">let</span><span class="pln"> i</span><span class="pun">=</span><span class="pln">$i</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">;</span><span class="kwd">done</span></code></li></ol></pre><p data-anchor-id="wgad">在其他的bash里cat</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="y4vn"><ol class="linenums"><li class="L0"><code><span class="pln">cat aaa</span><span class="pun">.</span><span class="pln">pipe</span></code></li><li class="L1"><code><span class="pln">hi </span><span class="com">#一个hi</span></code></li></ol></pre><p data-anchor-id="hxju">一直取结果,错误信息丢进null</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="o47i"><ol class="linenums"><li class="L0"><code><span class="com">#两个进程同时从pipe里取结果的情况下</span></code></li><li class="L1"><code><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="kwd">do</span><span class="pln"> cat xxx</span><span class="pun">.</span><span class="pln">pipe </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln"> </span><span class="str">/dev/</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span></code></li></ol></pre></div>
</body>
</html>